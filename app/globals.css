@tailwind base;
@tailwind components;
@tailwind utilities;

/* Import existing design tokens */
@import url('/tokens.css');

/* CSS containment for performance */
@layer utilities {
  .contain-layout {
    contain: layout;
  }
  
  .contain-style {
    contain: style;
  }
  
  .contain-paint {
    contain: paint;
  }
  
  .contain-size {
    contain: size;
  }
  
  .contain-strict {
    contain: strict;
  }
}

/* Enhanced base layer */
@layer base {
  html {
    scroll-behavior: smooth;
    overflow-x: hidden;
  }

  body {
    @apply text-text-primary bg-background font-mono;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-size-adjust: 100%;
    font-variant-ligatures: common-ligatures;
  }

  /* Enhanced typography with token integration */
  h1, h2, h3, h4, h5, h6 {
    @apply font-mono;
    font-variant-numeric: lining-nums;
  }
  
  h1 { @apply text-5xl font-bold leading-tight; }
  h2 { @apply text-4xl font-bold leading-tight; }
  h3 { @apply text-3xl font-bold leading-tight; }
  h4 { @apply text-2xl font-bold leading-tight; }
  h5 { @apply text-xl font-semibold leading-tight; }
  h6 { @apply text-lg font-semibold leading-normal; }

  p {
    @apply text-text-secondary leading-relaxed font-mono;
    max-width: 65ch;
    font-variant-numeric: lining-nums;
  }
  
  /* Enhanced interactive elements */
  a {
    @apply font-mono;
    transition: color var(--duration-normal) var(--ease-formless),
                background-color var(--duration-normal) var(--ease-formless);
  }
  
  button {
    @apply font-mono;
    transition: color var(--duration-normal) var(--ease-formless),
                background-color var(--duration-normal) var(--ease-formless),
                border-color var(--duration-normal) var(--ease-formless);
  }
  
  input, textarea, select {
    @apply font-mono;
    transition: color var(--duration-normal) var(--ease-formless),
                background-color var(--duration-normal) var(--ease-formless),
                border-color var(--duration-normal) var(--ease-formless);
  }
  
  label {
    @apply font-mono font-medium;
  }

  /* Enhanced focus states using tokens with proper contrast */
  *:focus-visible {
    @apply outline-2 outline-offset-2;
    outline-color: var(--color-accent);
    outline-style: solid;
    /* Ensure focus ring is never clipped */
    outline-offset: 2px;
    /* Fallback for browsers that don't support :focus-visible */
    box-shadow: 0 0 0 2px var(--color-accent);
  }

  /* Enhanced focus ring for critical navigation elements */
  .focus-ring-enhanced:focus-visible {
    outline: 3px solid var(--color-accent);
    outline-offset: 3px;
    box-shadow: 0 0 0 3px var(--color-accent), 0 0 0 6px rgba(255, 255, 255, 0.8);
  }

  /* High contrast focus rings */
  @media (prefers-contrast: high) {
    *:focus-visible {
      outline-width: 3px;
      outline-offset: 3px;
      box-shadow: 0 0 0 3px var(--color-accent), 0 0 0 6px var(--color-background);
    }
  }
}

/* Enhanced component layer */
@layer components {
  /* Container system using tokens */
  .container {
    @apply max-w-container mx-auto px-container-padding;
  }

  /* Section spacing using responsive tokens */
  .section {
    @apply py-section-padding;
  }

  /* Enhanced button system */
  .btn {
    @apply px-6 py-3 rounded-md font-mono font-semibold;
    @apply transition-all duration-normal ease-formless;
    @apply min-h-touch min-w-touch flex items-center justify-center gap-2;
    @apply hover:translate-y-[-1px] hover:shadow-hover-secondary;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent-focus;
  }

  .btn-primary {
    @apply btn bg-accent text-accent-ink hover:bg-accent-hover;
  }

  .btn-secondary {
    @apply btn border-2 border-accent text-accent-text;
    @apply hover:bg-accent hover:text-accent-ink;
  }

  .btn-ghost {
    @apply btn text-text-secondary hover:text-text-primary hover:bg-surface-hover;
  }

  .btn-icon {
    @apply btn p-3 min-w-touch;
  }

  /* Enhanced form elements */
  .form-input {
    @apply w-full px-4 py-3 border border-border rounded-md bg-surface;
    @apply text-text-primary font-mono transition-all duration-normal ease-formless;
    @apply focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent focus:ring-opacity-10;
    @apply min-h-touch placeholder:text-text-muted;
  }

  .form-label {
    @apply block font-mono font-medium text-text-primary mb-2;
  }

  .form-error {
    @apply text-error text-sm font-mono mt-1;
  }

  .form-help {
    @apply text-text-muted text-sm font-mono mt-1;
  }

  /* Enhanced card system */
  .card {
    @apply bg-surface border border-border rounded-lg p-8;
    @apply transition-all duration-normal ease-formless;
    @apply hover:shadow-hover-secondary hover:translate-y-[-1px];
  }

  .card-flat {
    @apply bg-surface border border-border rounded-lg p-6;
  }

  .card-elevated {
    @apply card shadow-md hover:shadow-lg;
  }

  /* Navigation components */
  .nav-link {
    @apply font-mono font-medium text-text-secondary;
    @apply transition-all duration-normal ease-formless;
    @apply hover:text-text-primary focus-visible:text-accent;
    @apply focus-visible:outline-2 focus-visible:outline-offset-4 focus-visible:outline-accent-focus;
    @apply rounded-sm px-3 py-2 min-h-touch flex items-center;
  }

  .nav-link-active {
    @apply nav-link text-accent bg-surface-hover;
  }

  /* Breadcrumb navigation */
  .breadcrumb {
    @apply flex items-center gap-2 text-sm font-mono;
  }

  .breadcrumb-item {
    @apply text-text-muted hover:text-text-primary transition-colors duration-normal ease-formless;
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent-focus;
    @apply rounded-sm;
  }

  .breadcrumb-item:not(:last-child)::after {
    content: '/';
    @apply text-text-muted ml-2;
  }

  .breadcrumb-current {
    @apply text-text-primary font-medium;
  }

  /* Badge components */
  .badge {
    @apply inline-flex items-center gap-1 px-3 py-1 text-sm font-mono font-medium;
    @apply bg-surface-hover text-text-secondary rounded-md;
  }

  .badge-accent {
    @apply badge bg-accent bg-opacity-10 text-accent;
  }

  .badge-success {
    @apply badge bg-success bg-opacity-10 text-success;
  }

  .badge-error {
    @apply badge bg-error bg-opacity-10 text-error;
  }

  /* Tech tag enhanced */
  .tech-tag {
    @apply badge transition-all duration-normal ease-formless;
    @apply hover:bg-accent hover:bg-opacity-10 hover:text-accent hover:scale-105;
  }

  /* Loading states */
  .skeleton {
    @apply bg-surface-hover rounded-md animate-pulse;
  }

  .loading-shimmer {
    @apply bg-gradient-to-r from-surface via-surface-hover to-surface;
    @apply bg-[length:200%_100%] animate-[shimmer_1.5s_infinite];
  }

  /* Interactive overlays */
  .overlay-gradient {
    @apply absolute inset-0 rounded-md opacity-overlay-rest;
    @apply transition-opacity duration-normal ease-formless;
    background: linear-gradient(135deg, var(--overlay-blue), var(--overlay-green));
  }

  .overlay-gradient:hover {
    @apply opacity-overlay-hover;
  }

  /* Focus management */
  .focus-ring {
    @apply focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent-focus;
  }

  .focus-ring-inset {
    @apply focus-visible:outline-2 focus-visible:outline-offset-[-2px] focus-visible:outline-accent-focus;
  }
}

/* Enhanced utility layer */
@layer utilities {
  /* Animation utilities using tokens */
  .transition-formless {
    transition-duration: var(--duration-normal);
    transition-timing-function: var(--ease-formless);
  }
  
  .transition-smooth {
    transition-duration: var(--duration-normal);
    transition-timing-function: var(--ease-out-expo);
  }
  
  .transition-spring {
    transition-duration: var(--duration-slow);
    transition-timing-function: var(--ease-spring);
  }

  .transition-instant {
    transition-duration: var(--duration-instant);
  }

  .transition-deliberate {
    transition-duration: var(--duration-deliberate);
  }
  
  /* Enhanced micro-interactions */
  .hover-lift {
    transition: transform var(--duration-normal) var(--ease-out-expo),
                box-shadow var(--duration-normal) var(--ease-out-expo);
  }
  
  .hover-lift:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover-secondary);
  }

  .hover-scale {
    transition: transform var(--duration-normal) var(--ease-spring);
  }

  .hover-scale:hover {
    transform: scale(1.02);
  }

  .hover-glow {
    transition: box-shadow var(--duration-normal) var(--ease-formless);
  }

  .hover-glow:hover {
    box-shadow: 0 0 20px -5px var(--color-accent);
  }
  
  /* Layout utilities using tokens */
  .container-padding {
    padding-left: var(--container-padding);
    padding-right: var(--container-padding);
  }

  .section-padding {
    padding-top: var(--section-padding);
    padding-bottom: var(--section-padding);
  }

  /* Text utilities */
  .text-balance {
    text-wrap: balance;
  }

  .text-pretty {
    text-wrap: pretty;
  }

  /* Touch target utilities */
  .touch-target {
    min-width: var(--touch-target-min);
    min-height: var(--touch-target-min);
    @apply flex items-center justify-center;
  }

  .touch-target-comfortable {
    min-width: var(--touch-target-comfortable);
    min-height: var(--touch-target-comfortable);
    @apply flex items-center justify-center;
  }

  /* Accessibility utilities */
  .sr-only {
    @apply absolute w-px h-px p-0 -m-px overflow-hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .not-sr-only {
    @apply static w-auto h-auto p-0 m-0 overflow-visible;
    clip: auto;
    white-space: normal;
  }

  /* Performance utilities */
  .content-auto {
    content-visibility: auto;
  }
  
  .content-hidden {
    content-visibility: hidden;
  }
  
  .gpu-accelerated {
    transform: translate3d(0, 0, 0);
    will-change: transform;
  }
  
  .layout-stable {
    contain: layout style;
  }
  
  .render-optimized {
    will-change: auto;
    transform: translateZ(0);
  }

  /* Theme utilities */
  .theme-transition {
    transition: color var(--duration-normal) var(--ease-formless),
                background-color var(--duration-normal) var(--ease-formless),
                border-color var(--duration-normal) var(--ease-formless),
                box-shadow var(--duration-normal) var(--ease-formless);
  }

  /* Gradient utilities */
  .gradient-primary {
    background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary));
  }

  .gradient-accent {
    background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-tertiary));
  }

  .gradient-text {
    background: linear-gradient(135deg, var(--gradient-primary), var(--gradient-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Z-index utilities */
  .z-dropdown { z-index: var(--z-dropdown); }
  .z-sticky { z-index: var(--z-sticky); }
  .z-fixed { z-index: var(--z-fixed); }
  .z-modal-backdrop { z-index: var(--z-modal-backdrop); }
  .z-modal { z-index: var(--z-modal); }
  .z-popover { z-index: var(--z-popover); }
  .z-tooltip { z-index: var(--z-tooltip); }
  .z-toast { z-index: var(--z-toast); }

  /* Prevent text selection */
  .select-disabled {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }
}

/* Enhanced keyframes */
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

/* Responsive token optimizations */
@media (max-width: 374px) {
  .container {
    @apply px-3;
  }
  
  .section {
    @apply py-8;
  }
}

@media (min-width: 375px) and (max-width: 767px) {
  .container {
    @apply px-4;
  }
  
  .section {
    @apply py-12;
  }
}

@media (min-width: 768px) {
  .container {
    @apply px-8;
  }
  
  .section {
    @apply py-20;
  }
}

@media (min-width: 1024px) {
  .section {
    @apply py-28;
  }
}

@media (min-width: 1280px) {
  .container {
    @apply px-12;
  }
  
  .section {
    @apply py-32;
  }
}

/* Enhanced accessibility and performance */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  html {
    scroll-behavior: auto;
  }
  
  /* Preserve essential visual feedback */
  .skip-link:focus,
  *:focus-visible {
    transition: none;
  }
  
  /* Keep hover states for usability */
  .btn:hover,
  .nav-link:hover {
    transition: none;
  }
  
  /* Disable complex animations but keep simple state changes */
  .nav-link-active-indicator::after {
    transition: none;
  }
  
  .loading-shimmer {
    animation: none;
    background: var(--color-surface);
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  :root {
    --color-border: #000000;
    --color-text-secondary: var(--color-text-primary);
  }
  
  [data-theme="dark"] {
    --color-border: #ffffff;
  }
  
  /* Enhanced focus rings for high contrast */
  *:focus-visible {
    outline-width: 3px;
    outline-offset: 3px;
    box-shadow: 0 0 0 3px var(--color-accent), 0 0 0 6px var(--color-background);
  }
  
  .skip-link {
    border-width: 3px;
    font-weight: bold;
  }
  
  .nav-link-active-indicator.active::after {
    width: 6px;
    height: 6px;
    border: 2px solid var(--color-background);
  }
  
  /* Ensure all interactive elements have clear borders */
  .btn,
  .nav-link,
  .form-input {
    border: 2px solid currentColor;
  }
  
  /* Enhanced shadows for better depth perception */
  .card,
  .mobile-menu {
    box-shadow: 0 0 0 2px var(--color-border), 0 4px 8px rgba(0, 0, 0, 0.3);
  }
  
  /* Make sure text has maximum contrast */
  .text-contrast-enhanced {
    color: var(--color-text-primary);
    background: var(--color-background);
    font-weight: 500;
  }
}

/* Large text and zoom support */
@media (min-resolution: 192dpi) {
  /* Higher DPI displays - ensure crisp focus rings */
  *:focus-visible {
    outline-width: 2px;
  }
}

@media (prefers-reduced-data: reduce) {
  /* Reduce animation complexity for low-bandwidth scenarios */
  .loading-shimmer {
    animation: none;
    background: var(--color-surface);
  }
  
  /* Disable complex animations */
  .hover-lift:hover,
  .hover-scale:hover,
  .hover-glow:hover {
    transform: none;
    box-shadow: none;
  }
}

/* Enhanced skip link with better contrast and positioning */
.skip-link {
  @apply absolute top-0 left-0 bg-accent text-accent-ink px-6 py-3 z-toast;
  @apply -translate-y-full focus:translate-y-0 transition-transform duration-normal ease-formless;
  @apply font-medium rounded-br-md shadow-lg;
  /* Ensure skip link has sufficient contrast */
  background: var(--color-accent);
  color: var(--color-background);
  border: 2px solid var(--color-background);
  min-height: 44px;
  display: flex;
  align-items: center;
}

.skip-link:focus {
  transform: translateY(0);
  /* Enhanced focus for skip links */
  outline: 3px solid var(--color-background);
  outline-offset: 2px;
}

/* Enhanced navigation active states */
.nav-link-active-indicator {
  position: relative;
}

.nav-link-active-indicator::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 4px;
  background: var(--color-accent);
  border-radius: 50%;
  opacity: 0;
  transition: opacity var(--duration-normal) var(--ease-formless);
}

.nav-link-active-indicator.active::after {
  opacity: 1;
}

/* Enhanced mobile menu accessibility */
.mobile-menu-backdrop {
  @apply fixed inset-0 bg-background bg-opacity-80 backdrop-blur-sm z-modal-backdrop;
  /* Prevent interaction with background content */
  touch-action: none;
}

/* Focus trap styles */
.focus-trap {
  position: relative;
}

.focus-trap-active {
  /* Ensure focus stays within the trap */
  contain: layout style;
}

/* Enhanced form accessibility */
.form-field-error {
  border-color: var(--color-error);
  box-shadow: 0 0 0 1px var(--color-error);
}

.form-field-error:focus {
  outline-color: var(--color-error);
  box-shadow: 0 0 0 2px var(--color-error);
}

/* Required field indicators */
.form-label-required::after {
  content: ' *';
  color: var(--color-error);
  font-weight: bold;
}

/* Status and live region styling */
.status-message {
  @apply sr-only;
  /* Ensure screen readers announce status changes */
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

.status-message-visible {
  @apply not-sr-only;
  @apply fixed top-4 right-4 bg-accent text-accent-ink px-4 py-2 rounded-md shadow-lg z-toast;
  /* Temporary visible status messages */
  animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Enhanced touch targets for accessibility */
.touch-target-enhanced {
  min-width: 48px;
  min-height: 48px;
  @apply flex items-center justify-center;
  /* Ensure touch targets don't overlap */
  margin: 2px;
}

/* Better color contrast utilities */
.text-contrast-enhanced {
  /* Ensure text meets WCAG AA contrast ratios */
  color: var(--color-text-primary);
  background: var(--color-background);
}

.text-contrast-enhanced-large {
  /* For large text (18pt+) that needs 3:1 contrast */
  color: var(--color-text-secondary);
}

/* Screen reader only content that becomes visible on focus */
.sr-only-focusable:focus,
.sr-only-focusable:active {
  @apply not-sr-only;
  @apply absolute top-0 left-0 bg-background text-text-primary p-2 z-toast;
}